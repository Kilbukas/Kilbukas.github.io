<!-- Include stylesheet -->
<link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">

<style>
    .line-dotted {
        border-style: dotted;
    }

    .line-solid {
        border-style: solid;
    }

    .line-double {
        border-style: double;
    }

    .ql-toolbar.ql-snow {
        background-color: #000000;
        width: 657;
    }

    .ql-container {
        background-color: #000000;
        color: #C0C0C0;
        font-family: Courier New, Courier, Lucida Sans Typewriter, Lucida Typewriter, monospace;
        width: 657;
    }

    .copy-formatted {
        color: #FFFFFF;
    }

    .fg-none {
        color: #000000;
    }

    .fg-green {
        color: #008000;
    }

    .fg-lgreen {
        color: #00FF00;
    }

    .fg-dblue {
        color: #000080;
    }

    .fg-cyan {
        color: #008080;
    }

    .fg-blue {
        color: #0000FF;
    }

    .fg-lblue {
        color: #00FFFF;
    }

    .fg-lred {
        color: #FF0000;
    }

    .fg-red {
        color: #800000;
    }

    .fg-purple {
        color: #800080;
    }

    .fg-pink {
        color: #FF00FF;
    }

    .fg-orange {
        color: #808000;
    }

    .fg-yellow {
        color: #FFFF00;
    }

    .fg-dgray {
        color: #808080;
    }

    .fg-lgreen {
        color: #C0C0C0;
    }

    .fg-white {
        color: #FFFFFF;
    }
</style>

<div id="toolbar">
    <button class="ql-underline"></button>
    <button class="ql-italic"></button>
    <div id="#fg-colors">
        <button class="ql-fgcolor" style="opacity: 0;" value="none"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #008000;" value="green"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #00FF00;" value="lgreen"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #000080;" value="dblue"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #008080;" value="cyan"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #0000FF;" value="blue"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #00FFFF;" value="lblue"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #FF0000;" value="lred"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #800000;" value="red"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #800080;" value="purple"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #FF00FF;" value="pink"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #808000;" value="orange"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #FFFF00;" value="yellow"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #808080;" value="dgray"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #C0C0C0;" value="gray"><b>A</b></button>
        <button class="ql-fgcolor" style="color: #FFFFFF;" value="white"><b>A</b></button>
        <button class="copy-formatted" onclick="copyFormatted()">Copy</button>
    </div>
</div>
<div id="editor"></div>
<script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
<script>
    const Parchment = Quill.import('parchment')
    var boxAttributor = new Parchment.Attributor.Class('fgcolor', 'fg', {
        scope: Parchment.Scope.INLINE,
        whitelist: ['none', 'green', 'lgreen', 'dblue', 'cyan', 'blue', 'lblue', 'red', 'lred', 'purple', 'pink', 'orange', 'yellow', 'dgray', 'gray', 'white']
    });
    Quill.register(boxAttributor);

    var toolbarOptions = [
        ['underline', 'italic'],
        [{ 'size': ['small', false, 'large', 'huge'] }],
    ]
    var quill = new Quill('#editor', {
        modules: {
            toolbar: {
                container: '#toolbar'
            }
        },
        theme: 'snow'
    });

    function copyFormatted() {
        var parsed = parseDelta(quill.getContents().ops);
        console.log(parsed);
    }

    function parseDelta(delta) {
        var parsed = '';
        for (op in delta) {
            parsed += wrapOp(delta[op]);
        }
        console.log(parsed);
    }

    function wrapOp(op) {
        var result = op.insert
        if (op.attributes == null) {
            return result
        }

        if (op.attributes.fgcolor) {
            switch (op.attributes.fgcolor) {
                case 'none':
                    result = '&x' + result;
                    break;
                case 'green':
                    result = '&g' + result;
                    break;
                case 'lgreen':
                    result = '&G' + result;
                    break;
                case 'dblue':
                    result = '&b' + result;
                    break;
                case 'cyan':
                    result = '&c' + result;
                    break;
                case 'blue':
                    result = '&B' + result;
                    break;
                case 'lblue':
                    result = '&C' + result;
                    break;
                case 'red':
                    result = '&r' + result;
                    break;
                case 'lred':
                    result = '&R' + result;
                    break;
                case 'purple':
                    result = '&p' + result;
                    break;
                case 'pink':
                    result = '&P' + result;
                    break;
                case 'orange':
                    result = '&O' + result;
                    break;
                case 'yellow':
                    result = '&Y' + result;
                    break;
                case 'dgray':
                    result = '&z' + result;
                    break;
                case 'gray':
                    result = '&w' + result;
                    break;
                case 'white':
                    result = '&W' + result;
                    break;

                default:
                    break;
            }
        }

        if (op.attributes.italic) {
            result = '&U' + result + '&D';
        }

        if (op.attributes.underline) {
            result = '&U' + result + '&D';
        }

        return result;
    }
</script>