<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <title>LOTJ color</title>
</head>

<body>
    <div id="editor"></div>
    <link href="https://cdn.quilljs.com/1.3.6/quill.snow.css" rel="stylesheet">
    <style>
        #editor {
            height: 90vh;
        }

        .line-dotted {
            border-style: dotted;
        }

        .line-solid {
            border-style: solid;
        }

        .line-double {
            border-style: double;
        }

        .ql-toolbar.ql-snow {
            background-color: #000000;
            min-width: 657px;
            max-width: 657px;
        }

        .ql-container {
            background-color: #000000;
            color: #C0C0C0;
            font-family: Courier New, Courier, Lucida Sans Typewriter, Lucida Typewriter, monospace;
            min-width: 657px;
            max-width: 657px;
        }

        .ql-snow .ql-color-picker .ql-picker-options {
            width: 133px;
        }

        #ql-picker-options-0 {
            counter-reset: color-number;
            counter-set: color-number -1;
        }

        #ql-picker-options-0 > span {
            font-size: 8px;
        }

        #ql-picker-options-0 > span:after {
            counter-increment: color-number;
            content: counter(color-number);
            background: inherit;
            background-clip: text;
            -webkit-background-clip: text;
            filter: invert(1) contrast(1);
            mix-blend-mode: difference;
        }

        #ql-picker-options-0 > span:nth-child(16) {
            margin-bottom: 20px;
            margin-right: 32px;
            
        }

    </style>
    <script src="https://cdn.quilljs.com/1.3.6/quill.js"></script>
    <script>
        const Parchment = Quill.import('parchment')
        const Delta = Quill.import('delta')
        var boxAttributor = new Parchment.Attributor.Class('fgcolor', 'fg', {
            scope: Parchment.Scope.INLINE,
            whitelist: ['none', 'green', 'lgreen', 'dblue', 'cyan', 'blue', 'lblue', 'red', 'lred', 'purple', 'pink', 'orange', 'yellow', 'dgray', 'gray', 'white']
        });
        Quill.register(boxAttributor);

        var xtermColors = [
            "#000000",
            "#800000",
            "#008000",
            "#808000",
            "#000080",
            "#800080",
            "#008080",
            "#c0c0c0",
            "#808080",
            "#ff0000",
            "#00ff00",
            "#ffff00",
            "#0000ff",
            "#ff00ff",
            "#00ffff",
            "#ffffff",
            "#000000",
            "#000033",
            "#000066",
            "#000099",
            "#0000cc",
            "#0000ff",
            "#003300",
            "#003333",
            "#003366",
            "#003399",
            "#0033cc",
            "#0033ff",
            "#006600",
            "#006633",
            "#006666",
            "#006699",
            "#0066cc",
            "#0066ff",
            "#009900",
            "#009933",
            "#009966",
            "#009999",
            "#0099cc",
            "#0099ff",
            "#00cc00",
            "#00cc33",
            "#00cc66",
            "#00cc99",
            "#00cccc",
            "#00ccff",
            "#00ff00",
            "#00ff33",
            "#00ff66",
            "#00ff99",
            "#00ffcc",
            "#00ffff",
            "#330000",
            "#330033",
            "#330066",
            "#330099",
            "#3300cc",
            "#3300ff",
            "#333300",
            "#333333",
            "#333366",
            "#333399",
            "#3333cc",
            "#3333ff",
            "#336600",
            "#336633",
            "#336666",
            "#336699",
            "#3366cc",
            "#3366ff",
            "#339900",
            "#339933",
            "#339966",
            "#339999",
            "#3399cc",
            "#3399ff",
            "#33cc00",
            "#33cc33",
            "#33cc66",
            "#33cc99",
            "#33cccc",
            "#33ccff",
            "#33ff00",
            "#33ff33",
            "#33ff66",
            "#33ff99",
            "#33ffcc",
            "#33ffff",
            "#660000",
            "#660033",
            "#660066",
            "#660099",
            "#6600cc",
            "#6600ff",
            "#663300",
            "#663333",
            "#663366",
            "#663399",
            "#6633cc",
            "#6633ff",
            "#666600",
            "#666633",
            "#666666",
            "#666699",
            "#6666cc",
            "#6666ff",
            "#669900",
            "#669933",
            "#669966",
            "#669999",
            "#6699cc",
            "#6699ff",
            "#66cc00",
            "#66cc33",
            "#66cc66",
            "#66cc99",
            "#66cccc",
            "#66ccff",
            "#66ff00",
            "#66ff33",
            "#66ff66",
            "#66ff99",
            "#66ffcc",
            "#66ffff",
            "#990000",
            "#990033",
            "#990066",
            "#990099",
            "#9900cc",
            "#9900ff",
            "#993300",
            "#993333",
            "#993366",
            "#993399",
            "#9933cc",
            "#9933ff",
            "#996600",
            "#996633",
            "#996666",
            "#996699",
            "#9966cc",
            "#9966ff",
            "#999900",
            "#999933",
            "#999966",
            "#999999",
            "#9999cc",
            "#9999ff",
            "#99cc00",
            "#99cc33",
            "#99cc66",
            "#99cc99",
            "#99cccc",
            "#99ccff",
            "#99ff00",
            "#99ff33",
            "#99ff66",
            "#99ff99",
            "#99ffcc",
            "#99ffff",
            "#cc0000",
            "#cc0033",
            "#cc0066",
            "#cc0099",
            "#cc00cc",
            "#cc00ff",
            "#cc3300",
            "#cc3333",
            "#cc3366",
            "#cc3399",
            "#cc33cc",
            "#cc33ff",
            "#cc6600",
            "#cc6633",
            "#cc6666",
            "#cc6699",
            "#cc66cc",
            "#cc66ff",
            "#cc9900",
            "#cc9933",
            "#cc9966",
            "#cc9999",
            "#cc99cc",
            "#cc99ff",
            "#cccc00",
            "#cccc33",
            "#cccc66",
            "#cccc99",
            "#cccccc",
            "#ccccff",
            "#ccff00",
            "#ccff33",
            "#ccff66",
            "#ccff99",
            "#ccffcc",
            "#ccffff",
            "#ff0000",
            "#ff0033",
            "#ff0066",
            "#ff0099",
            "#ff00cc",
            "#ff00ff",
            "#ff3300",
            "#ff3333",
            "#ff3366",
            "#ff3399",
            "#ff33cc",
            "#ff33ff",
            "#ff6600",
            "#ff6633",
            "#ff6666",
            "#ff6699",
            "#ff66cc",
            "#ff66ff",
            "#ff9900",
            "#ff9933",
            "#ff9966",
            "#ff9999",
            "#ff99cc",
            "#ff99ff",
            "#ffcc00",
            "#ffcc33",
            "#ffcc66",
            "#ffcc99",
            "#ffcccc",
            "#ffccff",
            "#ffff00",
            "#ffff33",
            "#ffff66",
            "#ffff99",
            "#ffffcc",
            "#ffffff",
            "#000000",
            "#0b0b0b",
            "#161616",
            "#212121",
            "#2c2c2c",
            "#373737",
            "#434343",
            "#4e4e4e",
            "#595959",
            "#646464",
            "#6f6f6f",
            "#7a7a7a",
            "#858585",
            "#909090",
            "#9b9b9b",
            "#a6a6a6",
            "#b1b1b1",
            "#bcbcbc",
            "#c8c8c8",
            "#d3d3d3",
            "#dedede",
            "#e9e9e9",
            "#f4f4f4",
            "#ffffff"
        ]

        var tools = [
            ['italic', 'underline', 'strike'],
            [{ 'color': xtermColors }]
        ]

        var quill = new Quill('#editor', {
            modules: {
                toolbar: tools
            },
            theme: 'snow'
        });

        quill.root.addEventListener('copy', e => copyParsed(e));
        quill.root.addEventListener('cut', e => copyParsed(e, true));
        quill.root.addEventListener('paste', pasteParsed.bind(this));

        function copyParsed(e, cut = false) {
            e.preventDefault();
            range = quill.selection.getRange()[0];
            if (range.length == 0) return;

            var rDelta = quill.getContents(range);
            var parsed = parseDelta(rDelta.ops);
            e.clipboardData.setData('text/plain', parsed);
            if (cut) {
                this.quill.deleteText(range, Quill.sources.USER);
            }
        }

        function pasteParsed(e) {
            e.preventDefault();
            var range = quill.getSelection(true);
            if (range == null) return;
            var pasteDelta = new Delta();
            var cb = e.clipboardData.getData('text/plain');
            // Too lazy to fix regex for catching the last match.
            cb = cb.replace('&D', '') + '&w';
            var parts = cb.match(/(&[xgbczGBCrOpwRYPWUI])?.+?(?=&|$)|\n/gm);
            for (part in parts) {
                op = getOp(parts[part]);
                pasteDelta.insert(op.raw, op.attr);
            }
            const delta = new Delta()
                .retain(range.index)
                .delete(range.length)
                .concat(pasteDelta);
            quill.updateContents(delta, Quill.sources.USER);
            quill.setSelection(delta.length() - range.length,
                Quill.sources.SILENT);
            quill.scrollIntoView();
        }

        function getOp(raw) {
            var tags = raw.match(/&[xgbczGBCrOpwRYPWUID]|&\d{3}/gm);
            var attr = {};
            for (tid in tags) {
                var tag = tags[tid];
                if (tag.length == 4) {
                    attr.color = xtermColors[parseInt(tag.replace('&', ''))]
                }
                if (tag == '&U') {
                    attr.underline = true;
                }
                if (tag == '&I') {
                    attr.italic = true;
                }
                else {
                    switch (tag) {
                        case '&x':
                            attr.color = xtermColors[0];
                            break;
                        case '&g':
                            attr.color = xtermColors[2];
                            break;
                        case '&G':
                            attr.color = xtermColors[10];
                            break;
                        case '&b':
                            attr.color = xtermColors[4];
                            break;
                        case '&c':
                            attr.color = xtermColors[6];
                            break;
                        case '&B':
                            attr.color = xtermColors[12];
                            break;
                        case '&C':
                            attr.color = xtermColors[14];
                            break;
                        case '&r':
                            attr.color = xtermColors[1];
                            break;
                        case '&R':
                            attr.color = xtermColors[9];
                            break;
                        case '&p':
                            attr.color = xtermColors[5];
                            break;
                        case '&P':
                            attr.color = xtermColors[13];
                            break;
                        case '&O':
                            attr.color = xtermColors[3];
                            break;
                        case '&Y':
                            attr.color = xtermColors[11];
                            break;
                        case '&z':
                            attr.color = xtermColors[8];
                            break;
                        case '&w':
                            attr.color = xtermColors[7];
                            break;
                        case '&W':
                            attr.color = xtermColors[15];
                            break;

                        default:
                            break;
                    }
                }
                raw = raw.replace(tag, '');
            }
            return { raw, attr };
        }

        function parseDelta(delta) {
            var parsed = '';
            for (op in delta) {
                parsed += wrapOp(delta[op]);
            }
            return parsed;
        }

        function wrapOp(op) {
            var result = op.insert
            if (op.attributes == null) {
                return '&D' + result
            }

            // Avoid duplicate clears.
            var needClear = false;

            if (op.attributes.color) {
                cid = xtermColors.indexOf(op.attributes.color).toString();
                while (cid.length < 3) cid = "0" + cid;
                result = '&' + cid + result;
            }


            if (op.attributes.italic) {
                result = '&I' + result;
                needClear = true;
            }

            if (op.attributes.underline) {
                result = '&U' + result;
                needClear = true;
            }

            if (needClear) result += '&D';

            return result;
        }

        function hexToRgb(hex) {
  var shorthandRegex = /^#?([a-f\d])([a-f\d])([a-f\d])$/i;
  hex = hex.replace(shorthandRegex, function(m, r, g, b) {
    return r + r + g + g + b + b;
  });

  var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
  return result ? {
    r: parseInt(result[1], 16),
    g: parseInt(result[2], 16),
    b: parseInt(result[3], 16)
  } : null;
}

function luminance(r, g, b) {
    var a = [r, g, b].map(function (v) {
        v /= 255;
        return v <= 0.03928
            ? v / 12.92
            : Math.pow( (v + 0.055) / 1.055, 2.4 );
    });
    return a[0] * 0.2126 + a[1] * 0.7152 + a[2] * 0.0722;
}

var ratios = []
var black = luminance(0, 0, 0)

xtermColors.forEach(element => {
    var rgb = hexToRgb(element)
    var lumin = luminance(rgb.r, rgb.g, rgb.b)
    const ratio = black > lumin 
    ? ((lumin + 0.05) / (black + 0.05))
    : ((black + 0.05) / (lumin + 0.05));
    ratios.push(ratio)
});

var dbratio = ratios[4];
var filtered = [];
for (let index = 0; index < ratios.length; index++) {
    const element = ratios[index] * 1.5;
    if (element >= dbratio) {
        filtered.push(index)
    }
}

console.log(JSON.stringify(filtered))
    </script>
</body>

</html>